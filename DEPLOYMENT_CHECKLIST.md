# SafeChat 部署检查清单

使用此清单确保 SafeChat 正确部署并可以投入使用。

## 前置准备

- [ ] Node.js 14+ 已安装
- [ ] MongoDB 4.4+ 已安装并运行
- [ ] （可选）Nginx/Apache 用于生产部署
- [ ] （可选）域名和 SSL 证书

## 后端部署检查

### 1. 安装依赖
- [ ] 运行 `npm install` 完成
- [ ] 无严重的安全警告（允许少量 warning）

### 2. 环境变量配置
- [ ] `MONGODB_URI` 已设置（或使用默认 localhost:27017）
- [ ] `JWT_SECRET` 已设置为安全的随机字符串（生产环境必须）
- [ ] `PORT` 已设置（默认 3001）
- [ ] `ALLOWED_ORIGINS` 已根据部署场景正确设置

### 3. MongoDB 连接
- [ ] MongoDB 服务正在运行
- [ ] 可以成功连接到 MongoDB
- [ ] safechat 数据库已创建（首次启动自动创建）

### 4. 后端启动
- [ ] 运行 `npm start` 后端启动成功
- [ ] 控制台显示 "Server listening on port 3001"
- [ ] 控制台显示 "Connected to MongoDB"
- [ ] 没有错误日志

### 5. API 健康检查
```bash
# 测试后端是否响应（如果有健康检查端点）
curl http://localhost:3001/api/health

# 或测试基本路由
curl http://localhost:3001/
```
- [ ] 返回 200 或正常响应

## 前端部署检查

### 1. 配置文件
- [ ] `frontend/modern/config.js` 文件存在
- [ ] 根据部署场景正确配置了 `apiBaseUrl`
- [ ] 根据部署场景正确配置了 `socketUrl`

### 2. 配置验证

#### 同域部署
- [ ] `apiBaseUrl: ''`（空字符串）
- [ ] `socketUrl: undefined`

#### 独立域名部署
- [ ] `apiBaseUrl` 设置为完整的后端 URL（含协议）
- [ ] `socketUrl` 设置为完整的后端 URL（含协议）
- [ ] 后端 `ALLOWED_ORIGINS` 包含前端域名

#### 不同端口（开发）
- [ ] `apiBaseUrl` 设置为 `http://localhost:3001`
- [ ] `socketUrl` 设置为 `http://localhost:3001`
- [ ] 后端 `ALLOWED_ORIGINS` 包含前端地址

### 3. 静态文件服务
- [ ] 前端文件可通过 Web 服务器访问
- [ ] `index.html` 可正常打开
- [ ] CSS 和 JavaScript 文件加载成功
- [ ] 无 404 错误

## 功能测试

### 1. 用户注册
- [ ] 打开前端页面
- [ ] 切换到"注册"标签
- [ ] 填写用户名、显示名称、密码
- [ ] 点击"注册并登录"
- [ ] 注册成功，自动登录

### 2. 用户登录
- [ ] 在登录表单输入已注册的用户名和密码
- [ ] 点击"登录"
- [ ] 登录成功，进入聊天界面
- [ ] 显示用户名和头像

### 3. 好友系统
- [ ] 点击搜索按钮（🔍）
- [ ] 输入其他用户名进行搜索
- [ ] 可以发送好友请求
- [ ] 被请求用户可以看到请求
- [ ] 可以接受或拒绝好友请求
- [ ] 好友列表正确显示

### 4. 私聊功能
- [ ] 点击好友列表中的好友
- [ ] 创建私聊会话
- [ ] 发送消息
- [ ] 好友可以实时收到消息
- [ ] 消息正确显示在聊天界面

### 5. 群聊功能
- [ ] 点击"创建群聊"
- [ ] 选择好友创建群组
- [ ] 群聊创建成功
- [ ] 可以在群组中发送消息
- [ ] 群组成员可以实时收到消息

### 6. 实时通信
- [ ] 打开两个浏览器标签或窗口
- [ ] 分别登录不同用户
- [ ] 一个用户发送消息
- [ ] 另一个用户实时收到消息
- [ ] 消息未延迟或丢失

### 7. 后台控制台
- [ ] 访问 `admin.html`
- [ ] 显示用户统计
- [ ] 显示会话统计
- [ ] 显示消息统计
- [ ] 数据准确无误

## 浏览器兼容性测试

- [ ] Chrome/Edge (推荐)
- [ ] Firefox
- [ ] Safari
- [ ] 移动浏览器（iOS Safari, Android Chrome）

## 性能检查

### 1. 页面加载
- [ ] 首次加载时间 < 3秒
- [ ] 资源全部加载成功
- [ ] 无控制台错误

### 2. API 响应
- [ ] 登录响应时间 < 1秒
- [ ] 消息发送响应时间 < 500ms
- [ ] 好友列表加载 < 1秒

### 3. WebSocket 连接
- [ ] Socket.IO 连接成功
- [ ] 无频繁断开重连
- [ ] 消息推送延迟 < 200ms

## 安全检查

### 1. 网络安全
- [ ] 生产环境使用 HTTPS
- [ ] JWT Token 不在 URL 中暴露
- [ ] 密码不以明文传输

### 2. 输入验证
- [ ] 用户名长度限制正确
- [ ] 密码强度要求合理
- [ ] XSS 攻击防护

### 3. 认证授权
- [ ] 未登录无法访问受保护的 API
- [ ] Token 过期后正确处理
- [ ] 无法访问其他用户的私密数据

## 错误处理检查

### 1. 网络错误
- [ ] 后端断开时前端显示友好错误
- [ ] 自动重连机制工作正常
- [ ] 断网恢复后可继续使用

### 2. 用户错误
- [ ] 错误的用户名/密码显示提示
- [ ] 重复注册显示提示
- [ ] 表单验证错误提示清晰

## 日志和监控

- [ ] 后端日志正确记录
- [ ] 错误日志包含足够信息用于排查
- [ ] （可选）设置了日志轮转
- [ ] （可选）配置了监控告警

## 备份和恢复

- [ ] MongoDB 数据备份策略已制定
- [ ] 测试过数据恢复流程
- [ ] 配置文件已备份

## 文档检查

- [ ] 阅读了 `README.md`
- [ ] 阅读了 `DEPLOYMENT.md`
- [ ] 阅读了 `QUICKSTART.md`
- [ ] （可选）阅读了 `ARCHITECTURE.md`

## 最终检查

- [ ] 所有上述检查项都已完成
- [ ] 在类生产环境中测试至少 24 小时
- [ ] 已准备好应急回滚方案
- [ ] 团队成员了解部署架构
- [ ] 用户支持文档已准备

---

**✅ 所有检查项完成后，SafeChat 可以投入生产使用！**

## 问题排查

如果遇到问题，请按以下顺序检查：

1. 查看浏览器控制台 (F12) 的 Console 和 Network 标签
2. 查看后端日志（`pm2 logs` 或 `npm start` 输出）
3. 检查 MongoDB 连接状态
4. 验证配置文件设置
5. 参考 `DEPLOYMENT.md` 的常见问题部分
6. 检查防火墙和安全组设置

## 维护建议

- [ ] 每周检查一次日志
- [ ] 每月更新依赖（运行 `npm audit` 和 `npm update`）
- [ ] 每月备份一次数据库
- [ ] 监控服务器资源使用情况
- [ ] 定期测试数据恢复流程
